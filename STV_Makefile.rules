$(LOCAL_OUT_ELF): $(LOCAL_OUT_OBJS) $(LOCAL_LINK_OBJS) $(LOCAL_LIBS)
	$(CC) $(LOCAL_CFLAGS) $(LOCAL_OUT_OBJS) $(LOCAL_LINK_OBJS) $(GLOBAL_LIBS) $(LOCAL_LIBS) -o $@ $(SYS_LIB_LDFLAGS) 

$(LOCAL_OUT_LIB): $(LOCAL_OUT_OBJS) $(LOCAL_LIBS)
	$(AR) crus $@ $(LOCAL_OUT_OBJS)

$(LOCAL_SHARE_LIB): $(LOCAL_OUT_OBJS) $(LOCAL_LIBS)
	$(CC) -shared -fPIC $^ -o $@ $(SYS_LIB_LDFLAGS)

%.o: %.c
	$(CC) $(LOCAL_CFLAGS) -fPIC $(LOCAL_INCDIRS) $(SYS_INC_DIRS) -c $< -o $@

BUILD_SUB_DIRS: 
	@$(foreach dir, $(MAKEDIRS),                         \
	$(MAKE) -C $(dir) all;                               \
	if [ "$$?" -ne "0" ]; then                           \
	  echo "ERROR - BUILD $(dir) STOPPED!";                     \
	  echo "BUILD $(dir) FAILED - Please fix above error!!";    \
	  exit 1;                                            \
	fi; )
	@-echo "Build $(MAKEDIRS) Passed."

clean: 
	$(RM) -rf *.o $(LOCAL_LINK_OBJS) $(LOCAL_OUT_ELF) $(LOCAL_OUT_LIB) $(LOCAL_OUT_OBJS) $(LOCAL_SHARE_LIB)
	$(foreach dir, $(MAKEDIRS), $(MAKE) -C $(dir) $@;)
	
